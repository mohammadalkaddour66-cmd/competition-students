<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مسابقة رمضان - مدرسة البراءة</title>
    
    <!-- الخطوط والأيقونات -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        clay: '#D27D56',
                        beige: '#F9F6F0',
                        brown: '#3E2723',
                        gold: '#D4AF37',
                        copper: '#B95C3E'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif'],
                        serif: ['Amiri', 'serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(62,39,35,0.08)',
                        'glow': '0 0 15px rgba(210,125,86,0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F9F6F0; height: 100vh; overflow: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #D27D56; border-radius: 10px; }
        
        /* البطاقات القلابة */
        .flip-container { perspective: 1200px; width: 100%; }
        .flip-inner {
            position: relative; width: 100%; height: 230px;
            transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            cursor: pointer;
        }
        .is-flipped { transform: rotateY(180deg); }
        .flip-front, .flip-back {
            position: absolute; inset: 0; backface-visibility: hidden;
            border-radius: 1.25rem; padding: 1.5rem; display: flex;
            flex-direction: column; justify-content: space-between;
        }
        .flip-back { transform: rotateY(180deg); background-color: #3E2723; color: white; }
        .flip-front { background: white; border-right: 6px solid #D27D56; }

        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0; transform: translateY(15px);
        }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        /* إخفاء القائمة عند تفعيل وضع "الرابط الخاص" */
        .standalone-mode #sidebar { display: none !important; }
        .standalone-mode main { margin-right: 0 !important; width: 100% !important; }
    </style>
</head>
<body class="text-brown antialiased selection:bg-clay selection:text-white">

    <div id="mobileOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-brown/50 z-40 hidden lg:hidden backdrop-blur-sm"></div>

    <div class="flex h-screen w-full overflow-hidden" id="appLayout">
        
        <!-- الشريط الجانبي (يختفي في وضع الرابط الخاص) -->
        <aside id="sidebar" class="fixed lg:static inset-y-0 right-0 z-50 w-72 bg-brown text-white flex flex-col transform translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out shadow-2xl flex-shrink-0">
            <div class="p-8 text-center border-b border-white/10">
                <div class="w-16 h-16 bg-gradient-to-br from-clay to-copper rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-glow">
                    <i class="fa-solid fa-moon text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold font-serif">أبطال البراءة</h1>
                <p class="text-xs text-gold font-bold mt-2">رمضان ١٤٤٥ هـ</p>
            </div>
            <nav class="flex-1 mt-6 px-4 space-y-3 overflow-y-auto" id="navMenu"></nav>
        </aside>

        <!-- المحتوى الرئيسي -->
        <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
            
            <!-- الترويسة -->
            <header class="bg-white px-6 py-4 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4 z-10 border-b border-gray-100 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <button id="sidebarToggle" onclick="toggleSidebar()" class="lg:hidden w-10 h-10 rounded-lg bg-beige flex items-center justify-center text-brown hover:bg-clay hover:text-white">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <div>
                        <h2 id="currentCategoryTitle" class="font-bold text-xl">مسابقة البراءة</h2>
                        <p id="currentCategorySubtitle" class="text-xs text-gray-500">جاري تحميل الأسئلة...</p>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row items-center gap-4 w-full md:w-auto">
                    <div class="relative w-full sm:w-64">
                        <i class="fa-solid fa-magnifying-glass absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="searchInput" oninput="handleSearch()" placeholder="بحث في الأسئلة..." 
                               class="w-full bg-beige border border-gray-200 text-brown text-sm rounded-xl pr-10 p-2.5 outline-none focus:ring-2 focus:ring-clay">
                    </div>
                    <div class="bg-beige px-4 py-2 rounded-xl w-full sm:w-56 border border-gray-200">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[10px] font-bold">إنجاز الحفظ</span>
                            <span id="progressText" class="text-xs font-black text-clay">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5 overflow-hidden">
                            <div id="progressBar" class="bg-clay h-full transition-all duration-700 w-0"></div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- منطقة الأسئلة -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8" id="mainScrollArea">
                <div class="max-w-6xl mx-auto mb-8 flex justify-between items-center">
                    <h3 class="text-xl font-serif font-bold text-brown">أسئلة فئتك المباركة</h3>
                    <button onclick="resetProgress()" class="text-[10px] text-gray-400 hover:text-red-500 transition-colors flex items-center gap-1">
                        <i class="fa-solid fa-rotate-left"></i> تصفير التقدم
                    </button>
                </div>
                <div id="questionsGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 max-w-6xl mx-auto pb-10"></div>
                <div id="noResults" style="display:none;" class="flex flex-col items-center py-20 text-center">
                    <i class="fa-solid fa-search text-4xl text-gray-200 mb-4"></i>
                    <p class="text-gray-500 font-bold">لا توجد نتائج مطابقة لبحثك</p>
                </div>
            </main>
        </div>
    </div>

    <script>
        const DB = {
            categories: [
                { id: 'baraem', title: 'براعم البراءة', sub: 'الصف الأول والثاني الابتدائي', icon: 'fa-seedling' },
                { id: 'fursan', title: 'فرسان البراءة', sub: 'الصف الثالث والرابع الابتدائي', icon: 'fa-bolt' },
                { id: 'rowad', title: 'رواد البراءة', sub: 'الصف الخامس والسادس الابتدائي', icon: 'fa-trophy' }
            ],
            questions: {
                baraem: [
                    { id: 'b1', q: "ما هو الشهر الذي نصومه كل عام؟", a: "شهر رمضان" },
                    { id: 'b2', q: "ماذا نسمي الوجبة التي نأكلها قبل الفجر؟", a: "السحور" },
                    { id: 'b3', q: "ماذا نسمي الوجبة التي نأكلها عند غياب الشمس؟", a: "الإفطار" },
                    { id: 'b4', q: "كم عدد أركان الإسلام؟", a: "خمسة أركان" },
                    { id: 'b5', q: "ما هو الركن الرابع من أركان الإسلام؟", a: "صوم رمضان" },
                    { id: 'b6', q: "من هو ربك؟", a: "الله سبحانه وتعالى" },
                    { id: 'b7', q: "من هو نبيك؟", a: "محمد ﷺ" },
                    { id: 'b8', q: "ما هو دينك؟", a: "الإسلام" },
                    { id: 'b9', q: "ماذا نقول قبل البدء بالأكل؟", a: "بسم الله" },
                    { id: 'b10', q: "ماذا نقول بعد الانتهاء من الأكل؟", a: "الحمد لله" },
                    { id: 'b11', q: "أين توجد الكعبة المشرفة؟", a: "في مكة المكرمة" },
                    { id: 'b12', q: "ما هو الكتاب الذي أنزله الله على نبينا محمد ﷺ؟", a: "القرآن الكريم" },
                    { id: 'b13', q: "ما اسم صلاة الجماعة في ليل رمضان؟", a: "صلاة التراويح" },
                    { id: 'b14', q: "كم عدد الصلوات في اليوم؟", a: "خمس صلوات" },
                    { id: 'b15', q: "أول صلاة في الصباح الباكر؟", a: "صلاة الفجر" },
                    { id: 'b16', q: "العيد بعد رمضان مباشرة؟", a: "عيد الفطر" },
                    { id: 'b17', q: "من هي أم النبي محمد ﷺ؟", a: "آمنة بنت وهب" },
                    { id: 'b18', q: "من هو والد النبي محمد ﷺ؟", a: "عبد الله بن عبد المطلب" },
                    { id: 'b19', q: "سورة نقرأها في كل ركعة؟", a: "سورة الفاتحة" },
                    { id: 'b20', q: "ماذا نقول عندما نعطس؟", a: "الحمد لله" },
                    { id: 'b21', q: "كم عدد أصابع اليد الواحدة؟", a: "خمسة أصابع" },
                    { id: 'b22', q: "كلمة الدخول في الصلاة؟", a: "الله أكبر" },
                    { id: 'b23', q: "من هو أول الأنبياء؟", a: "سيدنا آدم عليه السلام" },
                    { id: 'b24', q: "ما هي قبلة المسلمين؟", a: "الكعبة المشرفة" },
                    { id: 'b25', q: "هل نحب النبي محمد ﷺ؟", a: "نعم، نحن نحبه كثيراً" }
                ],
                fursan: [
                    { id: 'f1', q: "في أي ليلة من رمضان نزل القرآن الكريم أول مرة؟", a: "ليلة القدر" },
                    { id: 'f2', q: "كم عدد أركان الإيمان؟", a: "ستة أركان" },
                    { id: 'f3', q: "ما اسم الملك الموكل بالوحي؟", a: "جبريل عليه السلام" },
                    { id: 'f4', q: "باب الجنة للصائمين؟", a: "باب الريان" },
                    { id: 'f5', q: "من هو النبي الملقب بأبي الأنبياء؟", a: "سيدنا إبراهيم" },
                    { id: 'f6', q: "الكتاب الذي نزل على عيسى؟", a: "الإنجيل" },
                    { id: 'f7', q: "الكتاب الذي نزل على موسى؟", a: "التوراة" },
                    { id: 'f8', q: "أول من أذن في الإسلام؟", a: "بلال بن رباح" },
                    { id: 'f9', q: "أول قبلة للمسلمين؟", a: "المسجد الأقصى" },
                    { id: 'f10', q: "صحابي هاجر مع النبي ﷺ؟", a: "أبو بكر الصديق" },
                    { id: 'f11', q: "كم سنة استمر نزول القرآن؟", a: "23 سنة" },
                    { id: 'f12', q: "لقب النبي ﷺ قبل البعثة؟", a: "الصادق الأمين" },
                    { id: 'f13', q: "ما اسم ناقة النبي ﷺ؟", a: "القصواء" },
                    { id: 'f14', q: "من النبي الذي ابتلعه الحوت؟", a: "سيدنا يونس" },
                    { id: 'f15', q: "سورة تعدل ثلث القرآن؟", a: "سورة الإخلاص" },
                    { id: 'f16', q: "كم عدد أجزاء القرآن؟", a: "30 جزءاً" },
                    { id: 'f17', q: "متى فُرض الصيام؟", a: "2 هجرية" },
                    { id: 'f18', q: "غار نزل فيه الوحي؟", a: "غار حراء" },
                    { id: 'f19', q: "أول من آمنت من النساء؟", a: "خديجة بنت خويلد" },
                    { id: 'f20', q: "أول مسجد بُني في الإسلام؟", a: "مسجد قباء" },
                    { id: 'f21', q: "رحلة النبي ﷺ للقدس؟", a: "الإسراء والمعراج" },
                    { id: 'f22', q: "نبي كلمه الله مباشرة؟", a: "سيدنا موسى" },
                    { id: 'f23', q: "عدد ركعات صلاة المغرب؟", a: "3 ركعات" },
                    { id: 'f24', q: "كلمة الدخول في الإسلام؟", a: "الشهادتان" },
                    { id: 'f25', q: "ليلة القدر خير من كم شهر؟", a: "ألف شهر" }
                ],
                rowad: [
                    { id: 'r1', q: "أعظم آية في القرآن الكريم؟", a: "آية الكرسي" },
                    { id: 'r2', q: "أول غزوة في الإسلام في رمضان؟", a: "غزوة بدر الكبرى" },
                    { id: 'r3', q: "الملقب بسيف الله المسلول؟", a: "خالد بن الوليد" },
                    { id: 'r4', q: "سورة تُسمى قلب القرآن؟", a: "سورة يس" },
                    { id: 'r5', q: "نبي صبر على المرض طويلاً؟", a: "سيدنا أيوب" },
                    { id: 'r6', q: "سورة لا تبدأ بالبسملة؟", a: "سورة التوبة" },
                    { id: 'r7', q: "كم عدد سور القرآن؟", a: "114 سورة" },
                    { id: 'r8', q: "من هو الفاروق؟", a: "عمر بن الخطاب" },
                    { id: 'r9', q: "دابة الإسراء والمعراج؟", a: "البراق" },
                    { id: 'r10', q: "من هم أولو العزم من الرسل؟", a: "نوح، إبراهيم، موسى، عيسى، محمد ﷺ" },
                    { id: 'r11', q: "سورة تُسمى عروس القرآن؟", a: "سورة الرحمن" },
                    { id: 'r12', q: "نبي سُخرت له الريح والجن؟", a: "سيدنا سليمان" },
                    { id: 'r13', q: "أطول سورة في القرآن؟", a: "سورة البقرة" },
                    { id: 'r14', q: "كم سجدة تلاوة في القرآن؟", a: "15 سجدة" },
                    { id: 'r15', q: "في أي شهر تم فتح مكة؟", a: "شهر رمضان" },
                    { id: 'r16', q: "من هو ذو النورين؟", a: "عثمان بن عفان" },
                    { id: 'r17', q: "أصغر أبناء النبي محمد ﷺ؟", a: "إبراهيم" },
                    { id: 'r18', q: "دعاء ليلة القدر؟", a: "اللهم إنك عفو تحب العفو فاعفُ عني" },
                    { id: 'r19', q: "من خاتم الأنبياء؟", a: "سيدنا محمد ﷺ" },
                    { id: 'r20', q: "سورة بدأت باسم فاكهتين؟", a: "سورة التين" },
                    { id: 'r21', q: "من النبي الذي بنى السفينة؟", a: "سيدنا نوح" },
                    { id: 'r22', q: "صدقة واجبة قبل العيد؟", a: "زكاة الفطر" },
                    { id: 'r23', q: "سنوات الدعوة في مكة؟", a: "13 سنة" },
                    { id: 'r24', q: "سورة تنجي من عذاب القبر؟", a: "سورة الملك" },
                    { id: 'r25', q: "من هو أسد الله؟", a: "حمزة بن عبد المطلب" }
                ]
            }
        };

        let state = {
            currentCategory: 'baraem',
            searchQuery: '',
            isStandalone: false,
            memory: JSON.parse(localStorage.getItem('albaraa_quiz_memory')) || {}
        };

        function initApp() {
            // كشف الفئة من الرابط
            const params = new URLSearchParams(window.location.search);
            const catParam = params.get('cat') || params.get('category');
            
            if (catParam && DB.questions[catParam]) {
                state.currentCategory = catParam;
                state.isStandalone = true;
                document.body.classList.add('standalone-mode');
            }

            renderNavMenu();
            updateHeader();
            updateContent();
        }

        function renderNavMenu() {
            if (state.isStandalone) return;
            const nav = document.getElementById('navMenu');
            nav.innerHTML = DB.categories.map(cat => `
                <button onclick="changeCategory('${cat.id}')" 
                        class="w-full flex items-center gap-4 p-4 rounded-2xl transition-all duration-300 group ${state.currentCategory === cat.id ? 'bg-clay shadow-lg scale-105' : 'hover:bg-white/5 text-gray-400 hover:text-white'}">
                    <div class="p-2.5 rounded-xl ${state.currentCategory === cat.id ? 'bg-white/20' : 'bg-white/5 group-hover:bg-white/10'}">
                        <i class="fa-solid ${cat.icon} text-lg"></i>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-sm text-white">${cat.title}</div>
                        <div class="text-[10px] ${state.currentCategory === cat.id ? 'text-white/80' : 'text-gray-500'}">${cat.sub}</div>
                    </div>
                </button>
            `).join('');
        }

        function updateHeader() {
            const catObj = DB.categories.find(c => c.id === state.currentCategory);
            document.getElementById('currentCategoryTitle').innerText = catObj.title;
            document.getElementById('currentCategorySubtitle').innerText = catObj.sub;
            document.title = `مسابقة البراءة - ${catObj.title}`;
        }

        function changeCategory(catId) {
            state.currentCategory = catId;
            state.searchQuery = '';
            document.getElementById('searchInput').value = '';
            if(window.innerWidth < 1024) toggleSidebar();
            renderNavMenu();
            updateHeader();
            updateContent();
        }

        function handleSearch() {
            state.searchQuery = document.getElementById('searchInput').value.toLowerCase().trim();
            updateContent();
        }

        function updateContent() {
            const grid = document.getElementById('questionsGrid');
            const noResults = document.getElementById('noResults');
            grid.innerHTML = '';
            
            let filtered = DB.questions[state.currentCategory].filter(item => 
                item.q.toLowerCase().includes(state.searchQuery) || 
                item.a.toLowerCase().includes(state.searchQuery)
            );

            if (filtered.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'flex';
            } else {
                grid.style.display = '';
                noResults.style.display = 'none';
                
                filtered.forEach((item, index) => {
                    const isSaved = state.memory[item.id] || false;
                    const wrapper = document.createElement('div');
                    wrapper.className = 'flip-container fade-in-up';
                    wrapper.style.animationDelay = (index * 40) + 'ms';

                    wrapper.innerHTML = `
                        <div class="flip-inner" id="card-${item.id}" onclick="flipCard('${item.id}')">
                            <div class="flip-front shadow-sm border-r-4 ${isSaved ? 'border-green-500' : 'border-clay'}">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] text-gray-400">سؤال #${index + 1}</span>
                                    <i class="fa-solid fa-circle-check text-xl ${isSaved ? 'text-green-500' : 'text-gray-100'}"></i>
                                </div>
                                <p class="text-base font-bold text-brown leading-relaxed flex-1">${item.q}</p>
                                <div class="mt-2 text-[10px] text-clay font-bold opacity-60">انقر لمعرفة الجواب <i class="fa-solid fa-chevron-left"></i></div>
                            </div>
                            <div class="flip-back shadow-sm border-r-4 border-gold">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-[10px] text-gold font-bold">الإجابة الصحيحة</span>
                                    <button onclick="toggleSave(event, '${item.id}')" 
                                            class="px-3 py-1 rounded-lg text-[10px] font-bold border ${isSaved ? 'bg-green-600 border-green-500 text-white' : 'bg-white/5 border-white/20 text-gray-200'}">
                                        ${isSaved ? 'تم الحفظ ✅' : 'حفظت؟'}
                                    </button>
                                </div>
                                <div class="flex-1 flex items-center justify-center p-2">
                                    <p class="text-lg font-bold text-beige text-center">${item.a}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    grid.appendChild(wrapper);
                });
            }
            updateProgress();
        }

        function flipCard(id) {
            document.getElementById('card-' + id).classList.toggle('is-flipped');
        }

        function toggleSave(event, id) {
            event.stopPropagation();
            state.memory[id] = !state.memory[id];
            localStorage.setItem('albaraa_quiz_memory', JSON.stringify(state.memory));
            updateContent();
        }

        function updateProgress() {
            const currentQuestions = DB.questions[state.currentCategory];
            const saved = currentQuestions.filter(q => state.memory[q.id]).length;
            const percentage = Math.round((saved / currentQuestions.length) * 100);
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').innerText = percentage + '%';
        }

        function resetProgress() {
            if(confirm('هل تريد تصفير تقدمك في هذا القسم؟')) {
                DB.questions[state.currentCategory].forEach(q => delete state.memory[q.id]);
                localStorage.setItem('albaraa_quiz_memory', JSON.stringify(state.memory));
                updateContent();
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('translate-x-full');
            document.getElementById('mobileOverlay').classList.toggle('hidden');
        }

        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
